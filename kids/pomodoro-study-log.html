<!DOCTYPE html>
<html lang="ja">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1V1ELMWFTY"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-1V1ELMWFTY');
    </script>
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5115190227060860" crossorigin="anonymous"></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é›†ä¸­ãƒã‚¹ã‚¿ãƒ¼ Pro / Focus Master Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #4a90e2; --accent: #ff00ff; --bg: #111; --card: #ffffff; }
        body { font-family: "Hiragino Sans", sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 10px; box-sizing: border-box; min-height: 100vh; color: #fff; }
        
        .card { background: var(--card); padding: 20px; border-radius: 30px; box-shadow: 0 8px 20px rgba(0,0,0,0.5); text-align: center; width: 100%; max-width: 480px; border: 4px solid #fff; margin-bottom: 15px; box-sizing: border-box; color: #333; }
        
        .pomo-guide { text-align: left; font-size: 0.85rem; line-height: 1.5; color: #333; background: #fdfdfd; border-radius: 20px; padding: 18px; margin-bottom: 15px; border: 2px solid #eee; max-height: 400px; overflow-y: auto; }
        .pomo-guide summary { font-weight: bold; color: var(--primary); cursor: pointer; outline: none; margin-bottom: 8px; font-size: 1rem; border-bottom: 2px solid #eee; padding-bottom: 5px; }
        .pomo-guide h4 { border-left: 5px solid var(--accent); padding-left: 10px; margin: 15px 0 5px 0; color: #111; font-size: 0.95rem; }
        .point-box { background: #eef6ff; padding: 12px; border-radius: 12px; margin-top: 10px; font-size: 0.8rem; border-left: 4px solid var(--primary); }
        .en-small { display: block; color: #666; font-size: 0.75rem; margin-top: 2px; line-height: 1.2; }

        .timer-display { font-size: 4.5rem; font-weight: 900; color: var(--primary); margin: 10px 0; font-variant-numeric: tabular-nums; }
        .tag-input { width: 90%; padding: 12px; border-radius: 12px; border: 2px solid #ddd; font-size: 1rem; text-align: center; margin-bottom: 10px; -webkit-appearance: none; }
        
        .btn-main { width: 100%; padding: 18px; background: var(--accent); color: #fff; border: none; border-radius: 20px; font-weight: 800; font-size: 1.3rem; cursor: pointer; box-shadow: 0 5px 0 #c000c0; }
        .btn-main:active { transform: translateY(3px); box-shadow: 0 2px 0 #c000c0; }
        .btn-tool { background: #95a5a6; color: white; padding: 12px 16px; border-radius: 10px; border: none; font-size: 0.85rem; cursor: pointer; font-weight: bold; }
        .btn-danger { background: #ff4757; }
        
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 2000; align-items: center; justify-content: center; }
        .modal-content { background: white; padding: 25px; border-radius: 30px; width: 90%; max-width: 400px; text-align: center; color: #333; overflow-y: auto; max-height: 90vh; }
        
        .chart-container { height: 280px; margin-top: 10px; }
        .footer-area { width: 100%; max-width: 480px; text-align: center; margin-top: 25px; padding-bottom: 30px; }
        .footer-link { display: inline-block; color: #fff; text-decoration: none; font-size: 1.1rem; font-weight: bold; padding: 15px 30px; background: #444; border: 2px solid #666; border-radius: 15px; margin-bottom: 20px; }
        .copyright { color: #eee; font-size: 0.9rem; }

        /* ã‚¿ã‚°ãƒªã‚¹ãƒˆã®ã‚¹ã‚¿ã‚¤ãƒ«æ”¹å–„ */
        .tag-list-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid #eee; gap: 5px; }
        .tag-name-clickable { flex: 1; text-align: left; font-weight: bold; cursor: pointer; color: var(--primary); padding: 5px; border-radius: 5px; }
        .tag-name-clickable:hover { background: #f0f7ff; }
        
        .btn-alarm-stop { background: #ff4757; font-size: 1.8rem; padding: 25px; animation: pulse 1s infinite; margin-top: 20px; width: 100%; box-shadow: 0 6px 0 #b33030; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.03); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<div class="card">
    <div class="pomo-guide">
        <details open>
            <summary>ğŸ… ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ãƒ»ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã¨ã¯ï¼Ÿ <br><span style="font-size:0.8rem; font-weight:normal;">What is the Pomodoro Technique?</span></summary>
            <p>
                ã€Œ25åˆ†å‹‰å¼·ã€ã¯ã€<b>25åˆ†é›†ä¸­ï¼‹5åˆ†ä¼‘æ†©</b>ã‚’ç¹°ã‚Šè¿”ã™æ™‚é–“ç®¡ç†è¡“ã§ã™ã€‚è„³ã®ä»•çµ„ã¿ã«åŸºã¥ãã€åŠ¹ç‡ã‚’æœ€å¤§åŒ–ã—ã¾ã™ã€‚
                <span class="en-small">A method of 25-min focus + 5-min break to maximize efficiency based on brain science.</span>
            </p>
            <details>
                <summary>ğŸ“ ã‚„ã‚Šæ–¹ / How to do it</summary>
                <h4>1. ã‚¿ã‚¹ã‚¯ã‚’æ±ºã‚ã‚‹ / Set Task</h4>
                <p>ã‚„ã‚‹å†…å®¹ã‚’æ±ºã‚ã¾ã™ã€‚<span class="en-small">Decide what to study (e.g., 10 English words).</span></p>
                <h4>2. ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹ / Start Timer</h4>
                <p>25åˆ†é›†ä¸­ã—ã¾ã™ã€‚<span class="en-small">Focus for 25 minutes. (1 Pomodoro)</span></p>
                <h4>3. 5åˆ†ä¼‘æ†© / 5-min Break</h4>
                <p>ã‚¹ãƒãƒ›ã‚’è¦‹ãªã„ã®ãŒã‚³ãƒ„ã€‚<span class="en-small">Avoid smartphones to rest your brain.</span></p>
                <h4>4. é•·ã„ä¼‘æ†© / Long Break</h4>
                <p>4å›æ¯ã«30åˆ†ä¼‘ã¿ã¾ã™ã€‚<span class="en-small">Take 30-40 mins break after 4 Pomodoros.</span></p>
            </details>
            <details>
                <summary>âœ¨ åŠ¹æœ / Effects & Tips</summary>
                <div class="point-box">
                    <b>ğŸš€ é›†ä¸­åŠ›ã®ç¶­æŒ / Maintain Focus:</b> <br>ãƒªã‚»ãƒƒãƒˆã§ç–²ã‚Œé˜²æ­¢ <span class="en-small">Reset tiredness with short breaks.</span><br>
                    <b>â° ãƒ€ãƒ©ãƒ€ãƒ©é˜²æ­¢ / Prevent Procrastination:</b> <br>ã€Œ25åˆ†ã ã‘ã€ã§å³è¡Œå‹• <span class="en-small">Start immediately with "Just 25 mins".</span><br>
                    <b>ğŸ“ˆ ç¿’æ…£åŒ– / Habit Formation:</b> <br>è¨˜æ†¶ã®å®šç€ã¨è‡ªä¿¡ã« <span class="en-small">Leads to better memory and confidence.</span><br>
                    <b>ğŸ“¦ æº–å‚™ / Preparation:</b> <br>é“å…·ã‚’æƒãˆã¦ãŠã <span class="en-small">Clear your desk before starting.</span>
                </div>
            </details>
        </details>
    </div>

    <div style="position: relative; width: 100%;">
        <input type="text" id="studyTag" class="tag-input" list="tagHistory" placeholder="ä¾‹ï¼šæ•°å­¦ / Math">
        <datalist id="tagHistory"></datalist>
        <button class="btn-tool" style="background: #34495e; padding: 8px 15px; margin-bottom: 12px; width: 90%;" onclick="openTagManager()">ğŸ· ã‚¿ã‚°ã‚’é¸æŠãƒ»ç®¡ç† / Select Tags</button>
    </div>
    
    <div id="statusLabel" style="font-weight: bold; color: #666;">é›†ä¸­ã‚¿ã‚¤ãƒ  / Focus Time</div>
    <div class="timer-display" id="timerDisplay">25:00</div>
    <button id="startBtn" class="btn-main" onclick="toggleTimer()">ã‚¹ã‚¿ãƒ¼ãƒˆï¼ / START</button>
</div>

<div class="card">
    <div style="display:flex; justify-content: center; gap:5px; margin-bottom:10px;">
        <button class="btn-tool" onclick="changeRange(1, this)">ä»Šæ—¥ / Day</button>
        <button class="btn-tool" onclick="changeRange(7, this)">1é€± / Week</button>
        <button class="btn-tool" onclick="changeRange(30, this)">1æœˆ / Month</button>
    </div>
    <div class="chart-container"><canvas id="pomoChart"></canvas></div>
    <button class="btn-tool btn-danger" id="delTargetBtn" onclick="openDeleteModal()" style="display:none; width:100%; margin-top:10px; padding: 15px;">ğŸ—‘ ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ / Delete Data</button>
    <div style="display:flex; gap:8px; justify-content:center; margin-top:15px; border-top:1px solid #eee; padding-top:10px;">
        <button class="btn-tool" style="background:#27ae60;" onclick="exportData()">ğŸ’¾ ä¿å­˜ / Save</button>
        <button class="btn-tool" style="background:#2980b9;" onclick="document.getElementById('importFile').click()">ğŸ“‚ å¾©å…ƒ / Load</button>
        <input type="file" id="importFile" style="display:none" onchange="importData(event)">
    </div>
</div>

<div class="footer-area">
    <a href="./menu.html" class="footer-link">â† ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸ / Back to Menu</a>
    <div class="copyright">Â© 2026 KuniFami Soft Studio. <br>All Rights Reserved.</div>
</div>

<div id="tagManagerModal" class="modal">
    <div class="modal-content">
        <h3 style="margin-top:0;">ã‚¿ã‚°ã®é¸æŠ / Select Tags</h3>
        <button class="btn-tool" style="width:100%; background:var(--primary); margin-bottom:15px; padding:12px;" onclick="addNewTag()">ï¼‹ æ–°è¦ã‚¿ã‚°è¿½åŠ  / Add New Tag</button>
        <div id="tagListContainer" style="text-align:left; margin-bottom:20px; border-top:1px solid #eee;"></div>
        <button class="btn-tool" style="width:100%; background:#ccc;" onclick="closeTagManager()">é–‰ã˜ã‚‹ / Close</button>
    </div>
</div>

<div id="deleteModal" class="modal">
    <div class="modal-content">
        <h3 id="delTagTitle" style="color:var(--accent); margin-top:0;">ã‚¿ã‚°å‰Šé™¤ / Delete Tag</h3>
        <p id="delDateInfo"></p>
        <div style="margin:20px 0;">
            <label><span id="delValDisplay">25</span> åˆ† å‰Šé™¤ / Mins</label>
            <input type="range" id="delSlider" style="width:100%" step="25" min="25">
        </div>
        <div style="margin:15px 0;"><label><input type="checkbox" id="delAllCheck" onchange="toggleDelAll(this)"> å…¨ã¦å‰Šé™¤ / All</label></div>
        <div style="display:flex; gap:10px;">
            <button class="btn-tool" style="flex:1; background:#ccc;" onclick="closeDeleteModal()">æˆ»ã‚‹ / Back</button>
            <button class="btn-tool btn-danger" style="flex:1;" onclick="executeDelete()">å®Ÿè¡Œ / OK</button>
        </div>
    </div>
</div>

<div id="alarmModal" class="modal">
    <div class="modal-content">
        <h2 id="alarmTitle" style="color:var(--primary); font-size:2.2rem; margin:0;">æ™‚é–“ã§ã™ï¼</h2>
        <p style="font-size:1.2rem; margin:15px 0;">Time is up!</p>
        <button class="btn-main btn-alarm-stop" onclick="stopAlarm()">æ­¢ã‚ã‚‹ / OK</button>
    </div>
</div>

<script>
    const STUDY_TIME = 25 * 60; // 25 minutes
    const BREAK_TIME = 5 * 60;  // 5 minutes
    
    let timeLeft = STUDY_TIME;
    let timerIdx = null;
    let isBreak = false;
    let dailyStats = JSON.parse(localStorage.getItem('focus_master_stats')) || {};
    let tagHistory = JSON.parse(localStorage.getItem('focus_master_tags')) || [];
    let currentRange = 7;
    let myChart = null;
    let alarmInterval = null;
    let selectedTag = null;
    let selectedDate = null;
    let chartDates = [];
    let audioCtx = null;

    function initAudio() {
        if (!audioCtx) {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            gain.gain.value = 0;
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start(0); osc.stop(0.1);
        }
        if (audioCtx.state === 'suspended') audioCtx.resume();
    }

    function playNotificationSound() {
        if (!audioCtx) return;
        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        oscillator.type = 'sine';
        oscillator.frequency.setValueAtTime(880, audioCtx.currentTime);
        gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
        oscillator.start(); oscillator.stop(audioCtx.currentTime + 0.5);
    }

    function toggleTimer() {
        initAudio();
        const btn = document.getElementById('startBtn');
        if (timerIdx) {
            clearInterval(timerIdx); timerIdx = null;
            btn.textContent = "å†é–‹ / Resume";
        } else {
            btn.textContent = "ä¸€æ™‚åœæ­¢ / Pause";
            timerIdx = setInterval(() => {
                timeLeft--; updateTimerDisplay();
                if (timeLeft <= 0) { clearInterval(timerIdx); timerIdx = null; startAlarmLoop(); }
            }, 1000);
        }
    }

    function startAlarmLoop() {
        document.getElementById('alarmTitle').textContent = isBreak ? "ä¼‘æ†©çµ‚äº† / Break End" : "é›†ä¸­çµ‚äº† / Focus End";
        document.getElementById('alarmModal').style.display = 'flex';
        const trigger = () => { playNotificationSound(); if (navigator.vibrate) navigator.vibrate([500, 200, 500]); };
        trigger();
        alarmInterval = setInterval(trigger, 1500);
    }

    function stopAlarm() {
        if (alarmInterval) { clearInterval(alarmInterval); alarmInterval = null; }
        document.getElementById('alarmModal').style.display = 'none';
        handleTimerEnd(); 
    }

    function updateTimerDisplay() {
        const m = Math.floor(timeLeft / 60); const s = timeLeft % 60;
        document.getElementById('timerDisplay').textContent = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    }

    function handleTimerEnd() {
        const tag = document.getElementById('studyTag').value.trim() || "Etc";
        const today = new Date().toISOString().split('T')[0];
        if (!isBreak) {
            if (!dailyStats[today]) dailyStats[today] = {};
            dailyStats[today][tag] = (dailyStats[today][tag] || 0) + 25;
            if (!tagHistory.includes(tag)) tagHistory.push(tag);
            save(); isBreak = true; timeLeft = BREAK_TIME;
        } else {
            isBreak = false; timeLeft = STUDY_TIME;
        }
        updateStatusUI(); updateTimerDisplay(); renderChart(); updateTagList();
        document.getElementById('startBtn').textContent = "ã‚¹ã‚¿ãƒ¼ãƒˆï¼ / START";
    }

    function updateStatusUI() {
        const label = document.getElementById('statusLabel');
        label.textContent = isBreak ? "ä¼‘æ†©ä¸­ / Resting" : "é›†ä¸­ã‚¿ã‚¤ãƒ  / Focus Time";
        label.style.color = isBreak ? "#f39c12" : "#4a90e2";
    }

    function renderChart() {
        const ctx = document.getElementById('pomoChart').getContext('2d');
        const labels = []; chartDates = []; const datasetsMap = {}; const end = new Date();
        for (let i = currentRange - 1; i >= 0; i--) {
            const d = new Date(); d.setDate(end.getDate() - i);
            const ds = d.toISOString().split('T')[0];
            chartDates.push(ds);
            labels.push(`${d.getMonth()+1}/${d.getDate()}`);
            tagHistory.forEach(tag => {
                if (!datasetsMap[tag]) datasetsMap[tag] = [];
                datasetsMap[tag].push((dailyStats[ds] && dailyStats[ds][tag]) || 0);
            });
        }
        const datasets = Object.keys(datasetsMap).map((tag, idx) => ({
            label: tag, data: datasetsMap[tag], backgroundColor: `hsl(${idx * 137.5}, 70%, 60%)`, borderRadius: 5
        }));
        if (myChart) myChart.destroy();
        myChart = new Chart(ctx, {
            type: 'bar', data: { labels, datasets },
            options: {
                responsive: true, maintainAspectRatio: false,
                scales: { x: { stacked: true }, y: { stacked: true } },
                onClick: (e, elements) => {
                    if (elements.length > 0) {
                        const { datasetIndex, index } = elements[0];
                        selectedTag = myChart.data.datasets[datasetIndex].label;
                        selectedDate = chartDates[index];
                        const btn = document.getElementById('delTargetBtn');
                        btn.style.display = 'block';
                        btn.textContent = `ğŸ—‘ ${selectedDate} [${selectedTag}] å‰Šé™¤/Del`;
                    }
                }
            }
        });
    }

    function openTagManager() {
        const container = document.getElementById('tagListContainer');
        container.innerHTML = tagHistory.length ? '' : '<p style="text-align:center; padding:20px;">ã‚¿ã‚°å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“<br>No tag history</p>';
        tagHistory.forEach(tag => {
            const item = document.createElement('div');
            item.className = 'tag-list-item';
            item.innerHTML = `
                <div class="tag-name-clickable" onclick="selectTag('${tag}')">${tag}</div>
                <div style="display:flex; gap:5px;">
                    <button class="btn-tool" style="background:#2980b9; padding:5px 8px; font-size:0.75rem;" onclick="renameTag('${tag}')">ç·¨é›†/Edit</button>
                    <button class="btn-tool btn-danger" style="padding:5px 8px; font-size:0.75rem;" onclick="deleteTagHistory('${tag}')">æ¶ˆå»/Del</button>
                </div>
            `;
            container.appendChild(item);
        });
        document.getElementById('tagManagerModal').style.display = 'flex';
    }

    function selectTag(tag) {
        document.getElementById('studyTag').value = tag;
        closeTagManager();
    }

    function addNewTag() {
        const tag = prompt("æ–°ã—ã„ã‚¿ã‚°åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ / Enter new tag name:");
        if (tag && tag.trim()) {
            const trimmedTag = tag.trim();
            if (!tagHistory.includes(trimmedTag)) {
                tagHistory.push(trimmedTag);
                save();
                updateTagList();
                openTagManager();
            } else {
                alert("ãã®ã‚¿ã‚°ã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™ / Tag already exists");
            }
        }
    }

    function renameTag(oldName) {
        const newName = prompt(`æ–°ã—ã„åå‰ã‚’å…¥åŠ› / Enter new name for [${oldName}]:`, oldName);
        if (newName && newName !== oldName) {
            const idx = tagHistory.indexOf(oldName);
            if (tagHistory.includes(newName)) { tagHistory.splice(idx, 1); } 
            else { tagHistory[idx] = newName; }
            Object.keys(dailyStats).forEach(date => {
                if (dailyStats[date][oldName]) {
                    dailyStats[date][newName] = (dailyStats[date][newName] || 0) + dailyStats[date][oldName];
                    delete dailyStats[date][oldName];
                }
            });
            save(); renderChart(); updateTagList(); openTagManager();
        }
    }

    function deleteTagHistory(tag) {
        let hasData = false;
        for (const date in dailyStats) {
            if (dailyStats[date][tag]) {
                hasData = true;
                break;
            }
        }
        let confirmMsg = `å±¥æ­´ã‹ã‚‰ [${tag}] ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nDelete [${tag}] from history?`;
        if (hasData) {
            confirmMsg = `âš ï¸è­¦å‘Šï¼š[${tag}] ã®éå»ã®çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã‚‚ã™ã¹ã¦å‰Šé™¤ã•ã‚Œã¾ã™ï¼\næœ¬å½“ã«ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ\nWarning: All past stats for this tag will be deleted!`;
        }
        if (confirm(confirmMsg)) {
            tagHistory = tagHistory.filter(t => t !== tag);
            if (hasData) {
                for (const date in dailyStats) {
                    if (dailyStats[date][tag]) {
                        delete dailyStats[date][tag];
                    }
                }
            }
            save(); renderChart(); updateTagList(); openTagManager(); 
            document.getElementById('delTargetBtn').style.display = 'none';
        }
    }

    function closeTagManager() { document.getElementById('tagManagerModal').style.display = 'none'; }
    function openDeleteModal() {
        const maxTime = dailyStats[selectedDate][selectedTag];
        document.getElementById('delTagTitle').textContent = `å‰Šé™¤ / Delete [${selectedTag}]`;
        document.getElementById('delDateInfo').textContent = `${selectedDate}`;
        const slider = document.getElementById('delSlider');
        slider.max = maxTime; slider.value = 25; slider.disabled = false;
        document.getElementById('delValDisplay').textContent = 25;
        document.getElementById('delAllCheck').checked = false;
        slider.oninput = function() { document.getElementById('delValDisplay').textContent = this.value; };
        document.getElementById('deleteModal').style.display = 'flex';
    }
    function toggleDelAll(chk) {
        const slider = document.getElementById('delSlider');
        if (chk.checked) { slider.value = dailyStats[selectedDate][selectedTag]; slider.disabled = true; }
        else { slider.disabled = false; slider.value = 25; }
        document.getElementById('delValDisplay').textContent = slider.value;
    }
    function executeDelete() {
        const amount = parseInt(document.getElementById('delSlider').value);
        if (confirm(`å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ / Are you sure?`)) {
            dailyStats[selectedDate][selectedTag] -= amount;
            if (dailyStats[selectedDate][selectedTag] <= 0) delete dailyStats[selectedDate][selectedTag];
            save(); renderChart(); closeDeleteModal();
            document.getElementById('delTargetBtn').style.display = 'none';
        }
    }
    function closeDeleteModal() { document.getElementById('deleteModal').style.display = 'none'; }
    function save() {
        localStorage.setItem('focus_master_stats', JSON.stringify(dailyStats));
        localStorage.setItem('focus_master_tags', JSON.stringify(tagHistory));
    }
    function exportData() {
        const data = JSON.stringify({ stats: dailyStats, tags: tagHistory });
        const blob = new Blob([data], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = `focus_backup.json`; a.click();
    }
    function importData(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            const imported = JSON.parse(e.target.result);
            dailyStats = imported.stats; tagHistory = imported.tags;
            save(); renderChart(); updateTagList(); alert("Done!");
        };
        reader.readAsText(file);
    }
    function changeRange(days, btn) { currentRange = days; renderChart(); }
    function updateTagList() {
        const list = document.getElementById('tagHistory');
        list.innerHTML = tagHistory.map(t => `<option value="${t}">`).join('');
    }
    window.onload = () => { updateTimerDisplay(); renderChart(); updateTagList(); };
</script>
</body>
</html>
