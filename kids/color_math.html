<!DOCTYPE html>
<html lang="ja">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1V1ELMWFTY"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-1V1ELMWFTY');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>„Ç´„É©„Éï„É´Ë∂≥„ÅóÁÆó / Color Math</title>
    <style>
        :root { --primary: #FF5722; --secondary: #FFC107; --bg: #1a1a1a; --text: #ffffff; --card-bg: #2a2a2a; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        body { margin: 0; padding: 0; background-color: var(--bg); font-family: "Hiragino Sans", "Meiryo", sans-serif; color: var(--text); display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        
        .container { width: 92%; max-width: 420px; margin-top: 20px; text-align: center; }
        .screen { width: 100%; display: flex; flex-direction: column; align-items: center; }
        .hidden { display: none !important; }

        .icon-large { font-size: 4rem; margin-bottom: 5px; }
        .title-main { font-weight: bold; color: var(--text); font-size: 1.3rem; margin-bottom: 5px; }
        .title-sub { font-size: 0.7rem; color: #999; text-transform: uppercase; margin-bottom: 15px; }
        .badge { background: #FFEBEE; color: #D32F2F; font-size: 0.75rem; padding: 4px 12px; border-radius: 12px; display: inline-block; font-weight: bold; margin-bottom: 20px; }

        .rules { background: var(--card-bg); padding: 20px; border-radius: 25px; margin-bottom: 20px; text-align: left; border: 1px solid #444; }
        .rule-item { font-size: 0.8rem; line-height: 1.6; color: #ccc; margin-bottom: 10px; }
        .rule-item b { color: var(--secondary); }

        .game-panel { background: #ffffff; padding: 15px; border-radius: 30px; width: 100%; color: #333; margin-top: 10px; box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
        
        .color-palette { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 15px; }
        .color-item { width: 100%; aspect-ratio: 1/1; border-radius: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; border: 3px solid #eee; transition: 0.2s; position: relative; }
        .color-item.selected { border-color: #333; transform: scale(1.1); z-index: 2; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .color-item.selected::after { content: "‚úì"; position: absolute; top: -5px; right: -5px; background: #333; color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 12px; line-height: 18px; text-align: center; }

        .mix-display { background: #fdfdfd; border-radius: 20px; padding: 15px; border: 2px solid #f0f0f0; }
        .color-slots { display: flex; justify-content: center; align-items: center; gap: 8px; margin-bottom: 10px; flex-wrap: wrap; }
        .color-slot { width: 50px; height: 50px; border-radius: 50%; background: #eee; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; border: 2px solid #fff; box-shadow: inset 0 2px 4px rgba(0,0,0,0.05); }
        .operator { font-size: 1.2rem; font-weight: bold; color: #bbb; }
        
        .result-area { border-top: 2px dashed #eee; padding-top: 10px; margin-top: 10px; }
        .result-slot { width: 90px; height: 90px; border-radius: 50%; background: #eee; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; border: 5px solid #fff; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .result-name { font-size: 1rem; font-weight: bold; color: #FF5722; min-height: 2.8rem; line-height: 1.2; display: flex; align-items: center; justify-content: center; text-align: center; }

        .btn-action { background: #f0f0f0; color: #666; border: none; padding: 10px 20px; border-radius: 20px; font-size: 0.85rem; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-start { background: var(--primary); color: white; padding: 16px; border-radius: 50px; font-size: 1.1rem; width: 100%; border: none; box-shadow: 0 4px 0 #bf360c; font-weight: bold; cursor: pointer; }

        .copyright { font-size: 0.7rem; color: #666; margin: 20px 0; font-weight: bold; text-align: center; width: 100%; }
    </style>
</head>
<body>

<div id="startScreen" class="screen">
    <div class="container">
        <div class="icon-large">üåà</div>
        <div class="title-main">„Ç´„É©„Éï„É´Ë∂≥„ÅóÁÆó / Color Math</div>
        <div class="title-sub">Color Science Laboratory</div>
        <div class="badge">5„Åï„ÅÑ„Äú / Age 5+</div>

        <div class="rules">
            <div class="rule-item">
                „ÉªÂ•Ω„Åç„Å™Ëâ≤„Çí<b>3„Å§„Åæ„Åß</b>ÈÅ∏„Çì„Åß„Å≠ÔºÅ<br>
                „ÄÄ(Choose up to 3 colors!)
            </div>
            <div class="rule-item">
                „ÉªÊ∑∑„Åú„Çã„Å®„Å©„Çì„Å™Ëâ≤„Å´„Å™„Çã„Åã„Å™Ôºü<br>
                „ÄÄ(What color will it be?)
            </div>
            <div class="rule-item">
                „ÉªAI„ÅåËâ≤„ÅÆÂêçÂâç„ÇíÊïô„Åà„Å¶„Åè„Çå„Çã„Çà„ÄÇ<br>
                „ÄÄ(AI will tell you the color name.)
            </div>
        </div>

        <button class="btn-start" onclick="showGame()">„ÅØ„Åò„ÇÅ„Çã / Start</button>
        <a href="./menu.html" style="display:block; margin-top:20px; color:#666; text-decoration:none; font-size:0.8rem; font-weight:bold;">‚Üê „ÇÇ„Å©„Çã / Back</a>
        <div class="copyright" style="margin-top:40px;">¬© 2026 KuniFami Soft Studio</div>
    </div>
</div>

<div id="gameScreen" class="screen hidden">
    <div class="container">
        <div class="game-panel">
            <div id="guideText" style="font-weight: bold; margin-bottom: 12px; font-size: 0.85rem; color: #666;">„Åà„ÅÆ„Åê„Çí „Åà„Çâ„Çì„Åß„Å≠ / Choose Colors</div>

            <div class="color-palette" id="colorPalette"></div>

            <div class="mix-display">
                <div class="color-slots">
                    <div id="slot1" class="color-slot">?</div>
                    <div class="operator">+</div>
                    <div id="slot2" class="color-slot">?</div>
                    <div class="operator">+</div>
                    <div id="slot3" class="color-slot">?</div>
                </div>
                
                <div class="result-area">
                    <div id="resultSlot" class="result-slot">?</div>
                    <div id="resultName" class="result-name"></div>
                </div>
                
                <button class="btn-action" onclick="resetSelection()">„ÇÇ„ÅÜ‰∏ÄÂ∫¶ / Try Again</button>
            </div>

            <a href="./menu.html" style="display:block; margin-top:15px; color:#ccc; text-decoration:none; font-size:0.8rem;">‚Üê „ÇÇ„Å©„Çã / Back</a>
            <div class="copyright">¬© 2026 KuniFami Soft Studio</div>
        </div>
    </div>
</div>

<script>
    const colorData = [
        { name: '„ÅÇ„Åã', hex: '#FF0000', emoji: 'üî¥' },
        { name: '„ÅÇ„Åä', hex: '#0000FF', emoji: 'üîµ' },
        { name: '„Åç„ÅÑ„Çç', hex: '#FFFF00', emoji: 'üü°' },
        { name: '„Åó„Çç', hex: '#FFFFFF', emoji: '‚ö™' },
        { name: '„Åø„Å©„Çä', hex: '#00FF00', emoji: 'üü¢' },
        { name: '„Å†„ÅÑ„Å†„ÅÑ', hex: '#FFA500', emoji: 'üü†' },
        { name: '„ÇÄ„Çâ„Åï„Åç', hex: '#800080', emoji: 'üü£' },
        { name: '„ÇÇ„ÇÇ„ÅÑ„Çç', hex: '#FFC0CB', emoji: 'üå∏' },
        { name: '„Åø„Åö„ÅÑ„Çç', hex: '#87CEEB', emoji: 'üíé' },
        { name: '„Åç„Åø„Å©„Çä', hex: '#ADFF2F', emoji: 'ü•ù' },
        { name: '„Å°„ÇÉ„ÅÑ„Çç', hex: '#8B4513', emoji: 'ü™µ' },
        { name: '„Åè„Çç', hex: '#000000', emoji: '‚ö´' }
    ];

    let selectedColors = [];

    function showGame() {
        document.getElementById('startScreen').classList.add('hidden');
        document.getElementById('gameScreen').classList.remove('hidden');
        renderPalette();
    }

    function renderPalette() {
        const palette = document.getElementById('colorPalette');
        palette.innerHTML = '';
        colorData.forEach((color, i) => {
            const div = document.createElement('div');
            div.className = 'color-item';
            div.style.backgroundColor = color.hex;
            div.innerText = color.emoji;
            div.onclick = () => selectColor(color, div);
            palette.appendChild(div);
        });
    }

    function selectColor(color, el) {
        if (selectedColors.length >= 3 || el.classList.contains('selected')) return;
        selectedColors.push(color);
        el.classList.add('selected');
        const idx = selectedColors.length;
        const slot = document.getElementById('slot' + idx);
        slot.style.backgroundColor = color.hex;
        slot.innerText = color.emoji;
        if (selectedColors.length >= 2) mixColors();
    }

    function mixColors() {
        let r = 0, g = 0, b = 0;
        selectedColors.forEach(c => {
            const hex = c.hex.replace('#', '');
            r += parseInt(hex.substring(0, 2), 16);
            g += parseInt(hex.substring(2, 4), 16);
            b += parseInt(hex.substring(4, 6), 16);
        });
        r = Math.floor(r / selectedColors.length);
        g = Math.floor(g / selectedColors.length);
        b = Math.floor(b / selectedColors.length);
        const mixedHex = `#${r.toString(16).padStart(2,'0')}${g.toString(16).padStart(2,'0')}${b.toString(16).padStart(2,'0')}`;
        const resultSlot = document.getElementById('resultSlot');
        resultSlot.style.backgroundColor = mixedHex;
        resultSlot.innerText = '‚ú®';

        const pair = selectedColors.map(c => c.name).sort().join('+');
        const recipes = {
            '„ÅÇ„Åã+„Åç„ÅÑ„Çç': '„Å†„ÅÑ„Å†„ÅÑ / Orange',
            '„ÅÇ„Åã+„ÅÇ„Åä': '„ÇÄ„Çâ„Åï„Åç / Purple',
            '„ÅÇ„Åä+„Åç„ÅÑ„Çç': '„Åø„Å©„Çä / Green',
            '„ÅÇ„Åã+„Åó„Çç': '„Éî„É≥„ÇØ / Pink',
            '„ÅÇ„Åä+„Åó„Çç': '„Åø„Åö„ÅÑ„Çç / Light Blue',
            '„ÅÇ„Åã+„ÅÇ„Åä+„Åó„Çç': '„ÅÜ„Åô„ÇÄ„Çâ„Åï„Åç / Lavender',
            '„ÅÇ„Åã+„Åç„ÅÑ„Çç+„Åó„Çç': '„ÅÇ„Çì„Åö„ÅÑ„Çç / Apricot',
            '„ÅÇ„Åä+„Åç„ÅÑ„Çç+„Åó„Çç': '„Éö„Éº„É´„Ç∞„É™„Éº„É≥ / Pale Green',
            '„Åó„Çç+„Åè„Çç': '„ÅØ„ÅÑ„ÅÑ„Çç / Gray',
            '„ÅÇ„Åã+„Åç„ÅÑ„Çç+„ÅÇ„Åä': '„Å°„ÇÉ„ÅÑ„Çç / Brown'
        };

        let resultName = "";
        if (recipes[pair]) {
            resultName = recipes[pair];
        } else {
            if (r > 220 && g > 220 && b > 220) resultName = "„Åó„Çç„Å´Ëøë„ÅÑËâ≤ / Almost White";
            else if (r < 60 && g < 60 && b < 60) resultName = "„Åè„Çâ„ÅÑËâ≤ / Dark Color";
            else if (r > g + 30 && r > b + 30) resultName = (g > 100) ? "„ÅÇ„Åü„Åü„Åã„ÅÑËâ≤ / Warm Color" : "„ÅÇ„Åã„Åø„ÅÆ„Å§„Çà„ÅÑËâ≤ / Reddish Color";
            else if (g > r + 30 && g > b + 30) resultName = "„Åó„Åú„Çì„ÅÆËâ≤ / Greenish Color";
            else if (b > r + 30 && b > g + 30) resultName = "„Åô„Åö„Åó„ÅÑËâ≤ / Cool Bluish Color";
            else resultName = "„Åµ„Åó„Åé„Å™Ëâ≤ / Mysterious Color";
        }
        document.getElementById('resultName').innerText = resultName;
        playTone(300 + (selectedColors.length * 100));
    }

    function resetSelection() {
        selectedColors = [];
        [1,2,3].forEach(i => {
            const s = document.getElementById('slot' + i);
            s.style.backgroundColor = '#eee';
            s.innerText = '?';
        });
        document.getElementById('resultSlot').style.backgroundColor = '#eee';
        document.getElementById('resultSlot').innerText = '?';
        document.getElementById('resultName').innerText = '';
        document.querySelectorAll('.color-item').forEach(el => el.classList.remove('selected'));
    }

    function playTone(freq) {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = ctx.createOscillator();
        const g = ctx.createGain();
        osc.connect(g); g.connect(ctx.destination);
        osc.frequency.value = freq;
        g.gain.setValueAtTime(0.05, ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
        osc.start(); osc.stop(ctx.currentTime + 0.3);
    }
</script>

</body>
</html>
