<!DOCTYPE html>
<html lang="ja">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1V1ELMWFTY"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-1V1ELMWFTY');
    </script>

    <meta name="ad-mode" content="kids">
    <script src="/js/ads.js" defer></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <title>éŸ³éšç¥çµŒè¡°å¼±ï¼šä¼èª¬ / Pitch Match Legend - 3ã€œ5æ­³å‘ã‘ç„¡æ–™çŸ¥è‚²ã‚²ãƒ¼ãƒ </title>
    <meta name="description" content="[JP] éŸ³ã‚’è´ã„ã¦ãƒšã‚¢ã‚’å½“ã¦ã‚‹ç„¡æ–™ã®çŸ¥è‚²ã‚²ãƒ¼ãƒ ã€‚çµ¶å¯¾éŸ³æ„Ÿã‚„è¨˜æ†¶åŠ›ã‚’è‚²ã‚€ã€3ã€œ5æ­³ã®ãŠå­æ§˜ã«æœ€é©ãªã‚¢ãƒ—ãƒªã§ã™ã€‚[EN] A free educational game where you match pairs by listening to pitches. Perfect for kids aged 3-5 to develop perfect pitch and memory skills.">
    <meta name="keywords" content="çŸ¥è‚²ã‚²ãƒ¼ãƒ ,ç„¡æ–™,å­ä¾›å‘ã‘,éŸ³éš,ç¥çµŒè¡°å¼±,çµ¶å¯¾éŸ³æ„Ÿ,è¨˜æ†¶åŠ›,Educational Games,Kids Games,Memory Game,Pitch Match">
    <meta name="author" content="kunifami" >
    <meta name="robots" content="index, follow">

    <meta property="og:title" content="éŸ³éšç¥çµŒè¡°å¼±ï¼šä¼èª¬ - é›†ä¸­ãƒã‚¹ã‚¿ãƒ¼ Kids">
    <meta property="og:description" content="ãŠãªã˜éŸ³ã®ãƒšã‚¢ã‚’ã•ãŒãã†ï¼ã‚­ãƒŸã¯ã‚´ãƒ¼ãƒ«ãƒ‰ãƒ©ãƒ³ã‚¯ã«ãªã‚Œã‚‹ã‹ãªï¼Ÿ">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://kunifami-soft-studio.com/kids/pitch_match.html">
    <meta name="twitter:card" content="summary">
    
    <style>
        :root {
            --bg: #fdfdfd;
            --primary: #4834d4;
            --secondary: #686de0;
            --gold: #f1c40f;
            --silver: #bdc3c7;
            --bronze: #cd7f32;
            --card-back: #4834d4;
            --card-front: #ffffff;
            --shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        body {
            font-family: "Hiragino Sans", "Meiryo", sans-serif;
            background: #f0f2f5;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 100vh; margin: 0; padding: 0; overflow-x: hidden; touch-action: none;
        }

        /* ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ / Start Screen */
        .container {
            background: #fff; padding: 20px; border-radius: 35px;
            box-shadow: var(--shadow); text-align: center; width: 92%; max-width: 460px;
            border: 6px solid var(--primary); z-index: 10; overflow-y: auto; max-height: 95vh;
        }
        h1 { font-size: 1.4rem; color: var(--primary); margin: 5px 0; }
        
        .how-to-play {
            background: #fdf9e1; padding: 12px; border-radius: 15px;
            text-align: left; font-size: 0.75rem; color: #555; margin-bottom: 12px; border: 1px solid #ffeaa7;
        }
        .how-to-title { font-weight: bold; color: #d35400; margin-bottom: 4px; display: flex; align-items: center; gap: 5px; }

        .setting-box {
            background: #f1f2f6; padding: 12px; border-radius: 20px;
            border: 2px dashed var(--primary); margin-bottom: 12px;
        }
        .setting-label { font-weight: bold; font-size: 0.8rem; margin: 5px 0; color: var(--primary); }

        .selector { display: flex; justify-content: center; gap: 5px; margin-bottom: 8px; }
        .selector label {
            flex: 1; background: #fff; padding: 8px 2px; border-radius: 10px; border: 2px solid #ddd;
            cursor: pointer; font-size: 0.7rem; font-weight: bold; text-align: center;
        }
        .selector input:checked + label { background: var(--primary); color: white; border-color: var(--primary); }
        .selector input { display: none; }

        /* --- ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ãƒ»ã‚¬ã‚¤ãƒ‰è¨­å®š --- */
        .usage-guide {
            margin-top: 15px; font-size: 0.8rem; color: #666; text-align: left;
            background: #fff3e0; padding: 12px; border-radius: 15px; width: 100%;
        }
        .usage-guide p { margin: 0 0 8px 0; font-weight: bold; border-bottom: 1px solid #ffcc80; padding-bottom: 3px; }
        .usage-guide ul { margin: 0; padding-left: 1.2rem; line-height: 1.5; }
        .usage-guide li { margin-bottom: 5px; }
        .lang-en { display: block; font-size: 0.75rem; color: #888; margin-top: 2px; }

        .guide-container { margin-top: 20px; text-align: left; border-top: 1px solid #eee; padding-top: 15px; width: 100%; }
        details { margin-bottom: 10px; background: #f9f9f9; border-radius: 10px; overflow: hidden; border: 1px solid #eee; }
        summary {
            padding: 12px; font-weight: bold; cursor: pointer; color: #555;
            list-style: none; display: flex; justify-content: space-between; align-items: center;
            font-size: 0.85rem;
        }
        summary::after { content: 'â–¼'; font-size: 0.7rem; color: #aaa; }
        details[open] summary::after { content: 'â–²'; }
        .guide-content { padding: 15px; font-size: 0.85rem; color: #444; line-height: 1.6; border-top: 1px solid #eee; background: #fff; }
        .guide-content p { margin: 0 0 10px 0; }
        .hr-dashed { border: 0; border-top: 1px dashed #ddd; margin: 10px 0; }

        /* ã‚²ãƒ¼ãƒ ç”»é¢ / Game Screen */
        #gameScreen { 
            display: none; position: fixed; inset: 0; 
            background: linear-gradient(135deg, #4834d4 0%, #686de0 100%); 
            z-index: 100; flex-direction: column; align-items: center; justify-content: center;
        }

        .info-bar {
            display: flex; justify-content: space-between; width: 90%; max-width: 400px;
            margin-bottom: 15px; color: white; font-weight: bold; font-size: 1rem;
        }

        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; width: 90%; max-width: 400px; }

        .card {
            aspect-ratio: 1/1; background-color: var(--card-back);
            border-radius: 12px; cursor: pointer; position: relative;
            transform-style: preserve-3d; transition: transform 0.4s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .card.flipped { transform: rotateY(180deg); background-color: var(--card-front); }
        .card.matched { visibility: hidden; opacity: 0; }

        .card-inner { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .card-front { transform: rotateY(180deg); color: #333; }
        .note-name { font-size: 0.75rem; font-weight: bold; color: var(--primary); }

        /* ãƒœã‚¿ãƒ³ */
        .btn-main { width: 100%; padding: 16px; background: var(--primary); color: #fff; border: none; border-radius: 30px; font-weight: 800; font-size: 1.2rem; cursor: pointer; box-shadow: 0 6px 0 #2f3542; margin-bottom: 10px; }
        .btn-exit { position: absolute; top: 15px; right: 15px; padding: 8px 12px; background: white; border-radius: 10px; border: none; font-weight: bold; color: var(--primary); }

        .ad-container { width: 100%; min-height: 80px; background: #fafafa; border-radius: 15px; overflow: hidden; margin-top: 5px; }

        /* ä¿¡é ¼æ€§å‘ä¸Šç”¨ãƒªãƒ³ã‚¯ */
        .footer-links { margin-top: 15px; }
        .footer-links a { color: #888; text-decoration: none; font-size: 0.7rem; margin: 0 10px; }
        .footer-links a:hover { text-decoration: underline; }
        .footer-copyright { font-size: 0.6rem; color: #aaa; margin-top: 8px; }
    </style>
</head>
<body>

<div class="container" id="startScreen">
    <h1>éŸ³éšç¥çµŒè¡°å¼±ï¼šä¼èª¬</h1>
    <div style="font-size:0.8rem; font-weight:bold; color:#666; margin-bottom:10px;">Pitch Match Legend</div>

    <div class="how-to-play">
        <div class="how-to-title">ğŸ“– ã‚ãã³ã‹ãŸ / How to Play</div>
        ãƒ»ãŠãªã˜éŸ³ã®ãƒšã‚¢ã‚’ã•ãŒãã†ï¼ (Find pairs with the same sound!)<br>
        ãƒ»ãƒ©ã‚¤ãƒ•åˆ¶ï¼šã¾ã¡ãŒãˆã‚‹ã¨â¤ãŒã¸ã‚‹ã‚ˆ (Life: Don't lose hearts!)<br>
        ãƒ»ã‚¿ã‚¤ãƒ è¨ˆæ¸¬ï¼šã¯ã‚„ã•ã‚’ãããŠã†ï¼ (Time: Challenge your speed!)
    </div>
    
    <div class="setting-box">
        <div class="setting-label">1. ã¾ã„æ•° / Number of Cards</div>
        <div class="selector">
            <input type="radio" id="num8" name="cards" value="4" checked><label for="num8">8æš<br>8 Cards</label>
            <input type="radio" id="num12" name="cards" value="6"><label for="num12">12æš<br>12 Cards</label>
            <input type="radio" id="num16" name="cards" value="8"><label for="num16">16æš<br>16 Cards</label>
        </div>
        <div class="setting-label">2. ãƒ«ãƒ¼ãƒ« / Game Rule</div>
        <div class="selector">
            <input type="radio" id="rTime" name="rule" value="time" checked><label for="rTime">ã‚¿ã‚¤ãƒ è¨ˆæ¸¬<br>Time Trial</label>
            <input type="radio" id="rLife" name="rule" value="life"><label for="rLife">ãƒ©ã‚¤ãƒ•åˆ¶<br>Life Mode</label>
        </div>
        <div class="setting-label">3. è¡¨ç¤º / Display Mode</div>
        <div class="selector">
            <input type="radio" id="mIcon" name="mode" value="icon" checked><label for="mIcon">ãˆã¤ã<br>w/Icons</label>
            <input type="radio" id="mSound" name="mode" value="sound"><label for="mSound">ãŠã¨ã®ã¿<br>Sound Only</label>
        </div>
    </div>

    <button class="btn-main" onclick="initGame()">Start! / ã‚¹ã‚¿ãƒ¼ãƒˆï¼</button>

    <a href="./menu.html" style="display:inline-block; margin-top:8px; color:#aaa; text-decoration:none; font-size:0.75rem;">â† ã‚‚ã©ã‚‹ (Back)</a>

    <div class="usage-guide">
    <p>ã€ã”åˆ©ç”¨ã‚¬ã‚¤ãƒ‰ / Usage Guideã€‘</p>
    <ul>
    <li><strong>ãŠå­æ§˜ã«ï¼š</strong>æ­£ç¢ºãªãƒ”ãƒƒãƒï¼ˆéŸ³ã®é«˜ã•ï¼‰ã‚’èãåˆ†ã‘ã‚‹è¨“ç·´ã‚’é€šã˜ã¦ã€çµ¶å¯¾éŸ³æ„Ÿã®åŸºç¤ã¨é›†ä¸­åŠ›ã‚’é¤Šã„ã¾ã™ã€‚<span class="lang-en">(Nurtures the foundation of perfect pitch and focus by identifying accurate musical frequencies.)</span></li>
    <li><strong>ã‚·ãƒ‹ã‚¢ã®æ–¹ã«ï¼š</strong>éŸ³ã®è¨˜æ†¶ã¨å ´æ‰€ã®è¨˜æ†¶ã‚’åŒæ™‚ã«å‡¦ç†ã™ã‚‹ãƒãƒ«ãƒã‚¿ã‚¹ã‚¯å‹•ä½œãŒã€å‰é ­å‰é‡ã‚’å¼·åŠ›ã«æ´»æ€§åŒ–ã—ã¾ã™ã€‚<span class="lang-en">(Stimulates the prefrontal cortex via multi-tasking that integrates auditory and spatial memory.)</span></li>
    <li><strong>æ•™è‚²é–¢ä¿‚è€…ã®çš†æ§˜ã¸ï¼š</strong>ã€ŒéŸ³ã®ä¸å¯è¦–æ€§ã€ã‚’ã‚«ãƒ¼ãƒ‰ã¨ã„ã†è¦–è¦šçš„è¦ç´ ã§è£œå®Œã—ãŸã€æ„Ÿè¦šçµ±åˆã‚’ä¿ƒã™éŸ³æ¥½æ•™æã§ã™ã€‚<span class="lang-en">(An educational tool that promotes sensory integration by visualizing invisible musical pitches.)</span></li>
    </ul>
    </div>

    <div class="guide-container">
    <details>
    <summary>ã€ä¿è­·è€…å‘ã‘ï¼šçŸ¥è‚²ã®ç›®çš„ã€‘ / For Parents</summary>
    <div class="guide-content">
    <p><strong>Educational Goal ï¼ˆçŸ¥è‚²ã®ç›®çš„ï¼‰</strong></p>
    <p>ã“ã®ã‚¢ãƒ—ãƒªã¯ã€å¹¼å…æœŸã®èªçŸ¥ç™ºé”ã«ãŠã„ã¦æ¥µã‚ã¦é‡è¦ãªã€Œè´è¦šçš„è­˜åˆ¥åŠ›ï¼ˆAuditory Discriminationï¼‰ã€ã¨ã€Œä½œæ¥­è¨˜æ†¶ï¼ˆãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãƒ¡ãƒ¢ãƒªï¼‰ã€ã®å¼·åŒ–ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚
    
    å¾“æ¥ã®çµµåˆã‚ã›ã¨ã¯ç•°ãªã‚Šã€ã‚«ãƒ¼ãƒ‰ã‚’ã‚ãã£ãŸç¬é–“ã«æµã‚Œã‚‹ç‰¹å®šã®å‘¨æ³¢æ•°ã‚’è„³å†…ã§ä¸€æ™‚çš„ã«ä¿æŒï¼ˆä¿æŒï¼šãƒªãƒãƒ¼ã‚µãƒ«ï¼‰ã—ã€æ¬¡ã®éŸ³ã¨æ¯”è¼ƒã™ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã¯ã€éŸ³éŸ»æ„è­˜ã®å‘ä¸Šã«ç›´çµã—ã¾ã™ã€‚
    ã€ŒãŠã¨ã®ã¿ï¼ˆSound Onlyï¼‰ã€ãƒ¢ãƒ¼ãƒ‰ã§ã¯ã€è¦–è¦šæƒ…å ±ã«é ¼ã‚‰ãšè´è¦šæƒ…å ±ã®ã¿ã§è«–ç†çš„æ¨è«–ã‚’è¡Œã†ãŸã‚ã€é¸æŠçš„æ³¨æ„åŠ›ã‚’é«˜åº¦ã«è¦æ±‚ã—ã¾ã™ã€‚ã“ã®è¨“ç·´ã¯ã€å°†æ¥çš„ãªè¨€èªç²å¾—ã‚„éŸ³æ¥½çš„æ„Ÿæ€§ï¼ˆçµ¶å¯¾éŸ³æ„Ÿãƒ»ç›¸å¯¾éŸ³æ„Ÿï¼‰ã®åœŸå°ã‚’ç¯‰ãã€æˆåŠŸä½“é¨“ã‚’é€šã˜ã¦è‡ªå·±è‚¯å®šæ„Ÿã‚’è‚²ã¿ã¾ã™ã€‚</p>
    <hr class="hr-dashed">
    <p>This application is engineered to bolster "Auditory Discrimination" and "Working Memory," vital components of early childhood cognitive development. By temporarily maintaining specific frequencies (rehearsal) to compare with subsequent notes, children enhance their phonological awareness. The "Sound Only" mode demands high selective attention, as players must rely solely on auditory data for logical reasoning. This training establishes a foundation for language acquisition and musical sensibility while fostering self-esteem through successful match experiences.</p>
    </div>
    </details>
    <details>
    <summary>ã€ã‚·ãƒ‹ã‚¢å‘ã‘ï¼šã‚¢ãƒ—ãƒªã®ç›®çš„ã€‘ / For Seniors</summary>
    <div class="guide-content">
    <p><strong>App Goal ï¼ˆã‚¢ãƒ—ãƒªã®ç›®çš„ï¼‰</strong></p>
    <p>æœ¬ã‚¢ãƒ—ãƒªã¯ã€ã‚·ãƒ‹ã‚¢ä¸–ä»£ã®çš†æ§˜ã®ã€Œè„³ã®è‹¥è¿”ã‚Šã€ã¨ã€Œè´è¦šèªçŸ¥æ©Ÿèƒ½ã®ç¶­æŒã€ã‚’ç›®çš„ã¨ã—ãŸãƒ‡ã‚¸ã‚¿ãƒ«è„³ãƒˆãƒ¬ã§ã™ã€‚
    
    ç¥çµŒè¡°å¼±ã¨ã„ã†ãƒ«ãƒ¼ãƒ«ã«ã€ŒéŸ³ã€ã®è¦ç´ ã‚’åŠ ãˆã‚‹ã“ã¨ã§ã€å ´æ‰€ã‚’è¦šãˆã‚‹ã€Œè¦–ç©ºé–“è¨˜æ†¶ã€ã¨ã€éŸ³ã®é«˜ã•ã‚’è¦šãˆã‚‹ã€Œè´è¦šè¨˜æ†¶ã€ã‚’åŒæ™‚ã«åƒã‹ã›ã‚‹ãƒãƒ«ãƒã‚¿ã‚¹ã‚¯ï¼ˆäºŒé‡èª²é¡Œï¼‰ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚
    ã“ã®ãƒ—ãƒ­ã‚»ã‚¹ã¯è„³ã®æœ€é«˜ä¸­æ¢ã§ã‚ã‚‹å‰é ­å‰é‡ã‚’åˆºæ¿€ã—ã€åŠ é½¢ã«ä¼´ã„ä½ä¸‹ã—ã‚„ã™ã„çŸ­æœŸè¨˜æ†¶ã®ç¶­æŒã«è²¢çŒ®ã—ã¾ã™ã€‚ç‰¹ã«ã€Œãƒ©ã‚¤ãƒ•åˆ¶ã€ã«ã‚ˆã‚‹é©åº¦ãªç·Šå¼µæ„Ÿã¯é›†ä¸­åŠ›ã‚’é«˜ã‚ã€æ­£ç¢ºãªéŸ³ã‚’è´ãå‹•ä½œã¯è´è¦šç¥çµŒã®æ´»æ€§åŒ–ã‚’ä¿ƒã—ã¾ã™ã€‚ã‚·ãƒ³ãƒ—ãƒ«ãªãŒã‚‰ã‚‚ç§‘å­¦çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã€æ¥½ã—ã¿ãªãŒã‚‰èªçŸ¥ç—‡äºˆé˜²ã®ç¿’æ…£åŒ–ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚</p>
    <hr class="hr-dashed">
    <p>This app serves as a digital brain training tool aimed at "brain rejuvenation" and preserving "auditory cognitive function" for seniors. By adding sound to the classic memory game, it creates a dual-tasking challenge that integrates visuospatial and auditory memory. This process stimulates the prefrontal cortex, helping maintain short-term memory skills that often decline with age. The "Life Mode" provides optimal cognitive load to enhance focus, while identifying accurate pitches activates auditory nerve pathways. It is a scientifically grounded approach to dementia prevention that remains enjoyable as a daily habit.</p>
    </div>
    </details>
    </div>
    
    <div class="footer-links">
        <a href="privacy.html">Privacy Policy / è¦ç´„</a>
        <a href="contact.html">Contact / ãŠå•ã„åˆã‚ã›</a>
    </div>
    <div class="footer-copyright">Â© 2026 KuniFami Soft Studio. All Rights Reserved.</div>
</div>

<div id="gameScreen">
    <button class="btn-exit" onclick="stopGame()">Quit / ãŠã‚ã‚‹</button>
    <div class="info-bar">
        <div id="statusLabel">Time: 0.0s</div>
        <div id="lifeLabel"></div>
    </div>
    <div class="grid" id="grid"></div>
    <div class="footer-copyright" style="color:rgba(255,255,255,0.5); margin-top:20px;">Â© KuniFami Soft Studio</div>
</div>

<script>
    let audioCtx;
    const notesData = [
        { f: 261.63, i: 'ğŸ', jp: 'ãƒ‰', en: 'Do' }, { f: 293.66, i: 'ğŸŠ', jp: 'ãƒ¬', en: 'Re' },
        { f: 329.63, i: 'ğŸ‹', jp: 'ãƒŸ', en: 'Mi' }, { f: 349.23, i: 'ğŸˆ', jp: 'ãƒ•ã‚¡', en: 'Fa' },
        { f: 392.00, i: 'ğŸ‡', jp: 'ã‚½', en: 'Sol' }, { f: 440.00, i: 'ğŸ«', jp: 'ãƒ©', en: 'La' },
        { f: 493.88, i: 'ğŸ‘', jp: 'ã‚·', en: 'Ti' }, { f: 523.25, i: 'ğŸ’', jp: 'ãƒ‰', en: 'Do' }
    ];

    let flippedCards = [];
    let matchedPairs = 0;
    let canFlip = true;
    let totalPairs = 0;
    let startTime;
    let timerId;
    let initialLives = 0;
    let lives = 0;
    let gameActive = false;

    function playNote(freq) {
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'sine';
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 1.2);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + 1.2);
    }

    function initGame() {
        const pairCount = parseInt(document.querySelector('input[name="cards"]:checked').value);
        const rule = document.querySelector('input[name="rule"]:checked').value;
        const mode = document.querySelector('input[name="mode"]:checked').value;
        
        totalPairs = pairCount;
        matchedPairs = 0;
        flippedCards = [];
        gameActive = true;
        initialLives = (pairCount === 4) ? 3 : (pairCount === 6) ? 5 : 7;
        lives = initialLives;
        
        const statusLabel = document.getElementById('statusLabel');
        const lifeLabel = document.getElementById('lifeLabel');
        
        if (rule === 'time') {
            lifeLabel.innerText = "";
            startTime = Date.now();
            timerId = setInterval(() => {
                const sec = ((Date.now() - startTime) / 1000).toFixed(1);
                statusLabel.innerText = `Time: ${sec}s`;
            }, 100);
        } else {
            statusLabel.innerText = "Life Mode";
            updateLifeDisplay();
        }

        const selected = notesData.slice(0, pairCount);
        const gameSet = [...selected, ...selected].sort(() => Math.random() - 0.5);

        const grid = document.getElementById('grid');
        grid.innerHTML = '';
        gameSet.forEach(note => {
            const card = document.createElement('div');
            card.className = 'card';
            card.dataset.freq = note.f;
            card.innerHTML = `<div class="card-inner card-back">?</div><div class="card-inner card-front">
                <div style="font-size:1.5rem">${mode === 'icon' ? note.i : 'ğŸµ'}</div>
                <div class="note-name">${note.jp}/${note.en}</div></div>`;
            card.onclick = () => {
                if (!canFlip || !gameActive || card.classList.contains('flipped')) return;
                playNote(note.f);
                card.classList.add('flipped');
                flippedCards.push(card);
                if (flippedCards.length === 2) {
                    canFlip = false;
                    setTimeout(() => checkMatch(rule), 800);
                }
            };
            grid.appendChild(card);
        });
        document.getElementById('startScreen').style.display = 'none';
        document.getElementById('gameScreen').style.display = 'flex';
    }

    function updateLifeDisplay() { document.getElementById('lifeLabel').innerText = "â¤".repeat(lives); }

    function checkMatch(rule) {
        const [c1, c2] = flippedCards;
        if (c1.dataset.freq === c2.dataset.freq) {
            c1.classList.add('matched'); c2.classList.add('matched');
            matchedPairs++;
            if (matchedPairs === totalPairs) endGame(true, rule);
        } else {
            c1.classList.remove('flipped'); c2.classList.remove('flipped');
            if (rule === 'life') {
                lives--; updateLifeDisplay();
                if (lives <= 0) endGame(false, rule);
            }
        }
        flippedCards = []; canFlip = true;
    }

    function endGame(win, rule) {
        gameActive = false; clearInterval(timerId);
        setTimeout(() => {
            if (win) {
                let rank = "Bronze / ãƒ–ãƒ­ãƒ³ã‚º";
                if (rule === 'life') {
                    if (lives === initialLives) rank = "ğŸ¥‡ Gold / ã‚´ãƒ¼ãƒ«ãƒ‰ (Perfect!)";
                    else if (lives >= initialLives / 2) rank = "ğŸ¥ˆ Silver / ã‚·ãƒ«ãƒãƒ¼";
                } else {
                    const sec = (Date.now() - startTime) / 1000;
                    if (sec < totalPairs * 3) rank = "ğŸ¥‡ Gold / ã‚´ãƒ¼ãƒ«ãƒ‰ (Fast!)";
                    else if (sec < totalPairs * 5) rank = "ğŸ¥ˆ Silver / ã‚·ãƒ«ãƒãƒ¼";
                }
                alert(`Clear! / ã‚¯ãƒªã‚¢ï¼\nRank: ${rank}`);
            } else {
                alert("Game Over! / ã–ã‚“ã­ã‚“ï¼\nTry again! / ã¾ãŸæŒ‘æˆ¦ã—ã¦ã­ï¼");
            }
            stopGame();
        }, 300);
    }

    function stopGame() { clearInterval(timerId); gameActive = false; document.getElementById('startScreen').style.display = 'block'; document.getElementById('gameScreen').style.display = 'none'; }
</script>
</body>
</html>